From 6396e70d3fd381f6e3ccaff84c5a05bc5e3cec3c Mon Sep 17 00:00:00 2001
From: Joe Onorato <joeo@google.com>
Date: Thu, 31 May 2012 23:21:46 -0700
Subject: [PATCH] Multiple modules with the same name are going away.

Change-Id: I4154db066865d6031caa3c2c3b94064b2f28076e
---

diff --git a/Android.mk b/Android.mk
index 751ed72..5811c47 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,7 +1,21 @@
-LOCAL_PATH := $(call my-dir)
-include $(CLEAR_VARS)
+# Copyright (C) 2007 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
 
-commands_recovery_local_path := $(LOCAL_PATH)
+LOCAL_PATH := $(call my-dir)
+
+
+include $(CLEAR_VARS)
 
 LOCAL_SRC_FILES := \
     recovery.cpp \
@@ -20,25 +34,37 @@
 RECOVERY_API_VERSION := 3
 LOCAL_CFLAGS += -DRECOVERY_API_VERSION=$(RECOVERY_API_VERSION)
 
-LOCAL_STATIC_LIBRARIES :=
+LOCAL_STATIC_LIBRARIES := \
+    libext4_utils_static \
+    libsparse \
+    libminzip \
+    libz \
+    libmtdutils \
+    libmincrypt \
+    libminadbd \
+    libminui \
+    libpixelflinger_static \
+    libpng \
+    libcutils \
+    libstdc++ \
+    libc
 
 ifeq ($(TARGET_USERIMAGES_USE_EXT4), true)
-LOCAL_CFLAGS += -DUSE_EXT4
-LOCAL_C_INCLUDES += system/extras/ext4_utils
-LOCAL_STATIC_LIBRARIES += libext4_utils libsparse libz
+    LOCAL_CFLAGS += -DUSE_EXT4
+    LOCAL_C_INCLUDES += system/extras/ext4_utils
+    LOCAL_STATIC_LIBRARIES += libext4_utils_static libz
 endif
 
 ifeq ($(HAVE_SELINUX), true)
-LOCAL_C_INCLUDES += external/libselinux/include
-LOCAL_STATIC_LIBRARIES += libselinux
-LOCAL_CFLAGS += -DHAVE_SELINUX
+  LOCAL_C_INCLUDES += external/libselinux/include
+  LOCAL_STATIC_LIBRARIES += libselinux
+  LOCAL_CFLAGS += -DHAVE_SELINUX
 endif # HAVE_SELINUX
 
 # This binary is in the recovery ramdisk, which is otherwise a copy of root.
 # It gets copied there in config/Makefile.  LOCAL_MODULE_TAGS suppresses
 # a (redundant) copy of the binary in /system/bin for user builds.
 # TODO: Build the ramdisk image in a more principled way.
-
 LOCAL_MODULE_TAGS := eng
 
 ifeq ($(TARGET_RECOVERY_UI_LIB),)
@@ -46,15 +72,11 @@
 else
   LOCAL_STATIC_LIBRARIES += $(TARGET_RECOVERY_UI_LIB)
 endif
-LOCAL_STATIC_LIBRARIES += libext4_utils libsparse
-LOCAL_STATIC_LIBRARIES += libminzip libz libmtdutils libmincrypt libminadbd
-LOCAL_STATIC_LIBRARIES += libminui libpixelflinger_static libpng libcutils
-LOCAL_STATIC_LIBRARIES += libstdc++ libc
 
 ifeq ($(HAVE_SELINUX),true)
-LOCAL_C_INCLUDES += external/libselinux/include
-LOCAL_STATIC_LIBRARIES += libselinux
-LOCAL_CFLAGS += -DHAVE_SELINUX
+  LOCAL_C_INCLUDES += external/libselinux/include
+  LOCAL_STATIC_LIBRARIES += libselinux
+  LOCAL_CFLAGS += -DHAVE_SELINUX
 endif # HAVE_SELINUX
 
 LOCAL_C_INCLUDES += system/extras/ext4_utils
@@ -62,28 +84,30 @@
 include $(BUILD_EXECUTABLE)
 
 
+
 include $(CLEAR_VARS)
-
-LOCAL_SRC_FILES := verifier_test.cpp verifier.cpp ui.cpp
-
 LOCAL_MODULE := verifier_test
-
 LOCAL_FORCE_STATIC_EXECUTABLE := true
-
 LOCAL_MODULE_TAGS := tests
-
-LOCAL_STATIC_LIBRARIES := libmincrypt libminui libcutils libstdc++ libc
-
+LOCAL_SRC_FILES := \
+    verifier_test.cpp \
+    verifier.cpp \
+    ui.cpp
+LOCAL_STATIC_LIBRARIES := \
+    libmincrypt \
+    libminui \
+    libcutils \
+    libstdc++ \
+    libc
 include $(BUILD_EXECUTABLE)
 
 
-include $(commands_recovery_local_path)/minui/Android.mk
-include $(commands_recovery_local_path)/minelf/Android.mk
-include $(commands_recovery_local_path)/minzip/Android.mk
-include $(commands_recovery_local_path)/minadbd/Android.mk
-include $(commands_recovery_local_path)/mtdutils/Android.mk
-include $(commands_recovery_local_path)/tools/Android.mk
-include $(commands_recovery_local_path)/edify/Android.mk
-include $(commands_recovery_local_path)/updater/Android.mk
-include $(commands_recovery_local_path)/applypatch/Android.mk
-commands_recovery_local_path :=
+include $(LOCAL_PATH)/minui/Android.mk \
+    $(LOCAL_PATH)/minelf/Android.mk \
+    $(LOCAL_PATH)/minzip/Android.mk \
+    $(LOCAL_PATH)/minadbd/Android.mk \
+    $(LOCAL_PATH)/mtdutils/Android.mk \
+    $(LOCAL_PATH)/tools/Android.mk \
+    $(LOCAL_PATH)/edify/Android.mk \
+    $(LOCAL_PATH)/updater/Android.mk \
+    $(LOCAL_PATH)/applypatch/Android.mk
diff --git a/updater/Android.mk b/updater/Android.mk
index fcaf6d5..38bb1ae 100644
--- a/updater/Android.mk
+++ b/updater/Android.mk
@@ -21,7 +21,10 @@
 ifeq ($(TARGET_USERIMAGES_USE_EXT4), true)
 LOCAL_CFLAGS += -DUSE_EXT4
 LOCAL_C_INCLUDES += system/extras/ext4_utils
-LOCAL_STATIC_LIBRARIES += libext4_utils libsparse libz
+LOCAL_STATIC_LIBRARIES += \
+    libext4_utils_static \
+    libsparse \
+    libz
 endif
 
 ifeq ($(HAVE_SELINUX), true)

